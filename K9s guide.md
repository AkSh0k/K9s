# Описание
**K9s** — это **терминальный интерфейс (TUI) для Kubernetes**, который позволяет удобно управлять кластерами прямо из терминала.  
Он позволяет графически отслеживать состояние всех ресурсов (pods, deployments, services и т.д.) в реальном времени и даёт быстрый доступ к логам, описаниям, метрикам, подключение в контейнер и другим операциям.

Стоит отметить, что K9s работает поверх `kubectl` (официальный CLI-клиент Kubernetes) и использует уже готовый `kubeconfig`.
Данный TUI-интерфейс не заменяет `kubectl`, а просто предоставляет более наглядный и интерактивный способ управления ресурсами кластера.
### Основные возможности:
- просмотр всех ресурсов Kubernetes в режиме реального времени
- запуск команд типа `kubectl describe`, `kubectl logs`, `kubectl exec` без ручного ввода (через терминальный UI)
- фильтры, поиск, горячие клавиши
- управление несколькими контекстами
- перезапуск, удаление, отладка pod’ов
---
# Установка
## Предварительные требования
#### Перед установкой K9s необходимо иметь:
1. Доступ к Kubernetes-кластеру  
	- локальный (minikube, kind)
	- удалённый (bare metal / cloud)
2. Установленный `kubectl`
3. Корректный `kubeconfig`

K9s **не выполняет настройку кластера** и использует существующий `kubeconfig` для подключения к *Kubernetes API*.

Для тестирования K9s был использован **Minikube** — инструмент для развёртывания локального Kubernetes-кластера на одном компьютере.
Он позволяет быстро получить рабочую среду Kubernetes без настройки серверной инфраструктуры.


### 1. Установка базовых зависимостей и Podman:
```bash
sudo dnf install -y curl tar podman slirp4netns fuse-overlayfs conntrack socat
```

![1. Установка зависимостей](</images/1. Установка зависимостей.png>)
### 2. Установка `kubectl`
#### 2.1 Проверка — вдруг уже установлен
```bash
kubectl version --client
```
Если команда не найдена, необходимо выполнить установку.
#### 2.2 Установка официального бинарника Kubernetes
```bash
curl -LO https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl
```
(для ARM — `/bin/linux/arm64/kubectl`)*

\**для проверки архитектуры системы введите команду `uname -m`:* 
- `x86_64` — amd64 (Intel / AMD)
- `aarch64` — ARM64

#### 2.3 Выполнение установки и перемещение в соответствующую директорию:
```bash
chmod +x kubectl
sudo mv kubectl /usr/local/bin/
```
#### 2.4 Проверка:
```bash
kubectl version --client
```
![2. kubectl](</images/2. kubectl.png>)

### 3. Установка и настройка Minikube (c официального сайта Google API)
```bash
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
```
(для ARM — `minikube-linux-arm64`)

#### 3.1 Выполнение установки и перемещение в соответствующую директорию:
```bash
chmod +x minikube-linux-amd64
sudo mv minikube-linux-amd64 /usr/local/bin/minikube
```

#### 3.2 Проверка Podman:

```bash
podman version
```

![3. minikube](</images/3. minikube.png>)

Если Podman отсутствует в системе, необходимо выполнить повторную установку:
```bash
sudo dnf install podman slirp4netns fuse-overlayfs
```
#### 3.3 Настройка Minikube на Podman и включение rootless-режима:
```bash
minikube config set driver podman
minikube config set rootless true
```

#### 3.4 Проверка изменения конфиг-файла Minikube:
```bash
minikube config view
```


![4. minikube config](</images/4. minikube config.png>)

В выводе нам говорится, что эти изменения применятся только после удаления Kubernetes-кластера Minikube и вторичного создания, но это сообщение является шаблонным и ничего не значит, так как изменения уже внесены в конфигурационный файл.
#### 3.5 Запуск Minikube
```bash
minikube start --container-runtime=containerd
```
Параметр `--container-runtime=containerd` указывает Minikube использовать `containerd` в качестве контейнерного рантайма Kubernetes, что позволяет отказаться от Docker Engine и корректно использовать Podman в режиме rootless.

### 4. Настройка тестового пода
#### 4.1 Создание тестового пода NGINX (легковесный веб-сервер)
```bash
kubectl create deployment nginx --image=nginx
kubectl get pods
```
![6. nginx](</images/6. nginx.png>)

Если в списке отображается тестовый под Nginx, то установка и настройка прошла успешно!


Далее можно переходить к установке самого K9s.
## Установка K9s
### 1. Скачать последнюю версию
```bash
curl -LO https://github.com/derailed/k9s/releases/latest/download/k9s_Linux_amd64.tar.gz
```
(если ARM — `k9s_Linux_arm64.tar.gz`)
### 2. Распаковать
```bash
tar -xzf k9s_Linux_amd64.tar.gz
```
### 3. Переместить бинарник
```bash
sudo mv k9s /usr/local/bin/ 
sudo chmod +x /usr/local/bin/k9s
```
### 4. Проверка
```bash
k9s version
```
![7. k9s version](</images/7. k9s version.png>)

---
# Начало работы с K9s
```bash
k9s
```
Что происходит:
- читается `~/.kube/config`
- подключение к текущему контексту
- загрузка ресурсов кластера  
## Структура интерфейса K9s
![8. k9s](</images/8. k9s.png>)
### Интерфейс состоит из:
1. **Главной таблицы ресурсов**
2. **Командная строка (command prompt) `:`**
3. **Горячие клавиши**
4. **Статус-бар (внизу)**

### Навигация:
- ↑ ↓ — перемещение
- `Enter` — переход внутрь ресурса
- `Esc` — назад
- `Ctrl + C` — выход из K9s

---

## Основные режимы и команды
Для ввода команды необходимо нажать `:`, после чего откроется командная строка K9s:
![9. com prompt](</images/9. com prompt.png>)

Ниже представлен список всех поддерживаемых команд для отображения таблиц ресурсов и прочих данных:

| Команда   | Что отображает         |
| --------- | ---------------------- |
| `:po`     | Pods                   |
| `:deploy` | Deployments            |
| `:svc`    | Services               |
| `:ns`     | Namespaces             |
| `:ctx`    | Contexts               |
| `:node`   | Nodes                  |
| `:rs`     | ReplicaSets            |
| `:sts`    | StatefulSets           |
| `:ds`     | DaemonSets             |
| `:job`    | Jobs                   |
| `:cj`     | CronJobs               |
| `:ing`    | Ingress                |
| `:cm`     | ConfigMaps             |
| `:sec`    | Secrets                |
| `:pvc`    | PersistentVolumeClaims |
| `:pv`     | PersistentVolumes      |

---

## Работа с Pod

Находясь в списке pod’ов:

|Клавиша|Действие|
|---|---|
|`l`|Logs|
|`s`|Shell (exec внутрь контейнера)|
|`d`|Describe|
|`y`|YAML|
|`e`|Edit|
|`r`|Restart|
|`x`|Delete|
|`c`|Переключение контейнера|
|`Ctrl+l`|Очистить экран|

Пример: 
`:po → выбрать pod → l`

---
# Типовые сценарии использования K9s

Данный раздел описывает практические примеры использования K9s при повседневной работе с Kubernetes-кластером. Приведённые сценарии отражают наиболее частые задачи администрирования и диагностики и демонстрируют преимущества интерактивного терминального интерфейса.
## 1. Отладка pod’а, завершившегося с ошибкой
Одной из наиболее распространённых задач является анализ pod’ов, находящихся в состояниях `CrashLoopBackOff`, `Error` или `Pending`.

В K9s это выполняется следующим образом:
- переход в список pod’ов (`:po`);
- выбор pod’а с некорректным состоянием;
- просмотр журналов работы контейнера (`l`);
- при необходимости — просмотр подробного описания ресурса (`d`).

Такой подход позволяет быстро определить причину сбоя (ошибка приложения, нехватка ресурсов, проблемы с образом контейнера) без последовательного ввода нескольких команд `kubectl`.

## 2. Просмотр журналов работы контейнеров в режиме реального времени
При запуске и отладке приложений часто требуется наблюдать журналы контейнера по мере их появления.

K9s предоставляет возможность непрерывного просмотра журналов:
- выбор pod’а;
- переход в режим просмотра журналов (`l`).

Журналы обновляются автоматически, что позволяет оперативно отслеживать поведение приложения без повторного выполнения команд.

## 3. Подключение к контейнеру для диагностики
В ряде случаев требуется проверить файловую систему контейнера, переменные окружения или доступность сетевых ресурсов.

Для этого в K9s предусмотрено подключение к контейнеру:
- выбор pod’а;
- переход в интерактивную сессию контейнера (`s`).

Выход из интерактивной сессии осуществляется с помощью сочетания клавиш `Ctrl + D`.

Следует учитывать, что не все pod’ы (в частности, системные) поддерживают интерактивный режим работы.

## 4. Перезапуск Deployment без повторного применения манифестов
После изменения конфигурации или устранения ошибок может потребоваться перезапуск всех pod’ов, управляемых Deployment.

В K9s это выполняется следующим образом:
- переход в список Deployment (`:deploy`);
- выбор нужного Deployment;
- выполнение команды перезапуска (`r`).

Перезапуск осуществляется без изменения манифестов и без использования командного клиента `kubectl`.

## 5. Переключение между кластерами и пространствами имён
При работе с несколькими окружениями (например, тестовым и продуктивным) важно быстро переключаться между ними.

K9s поддерживает:
- переключение контекста Kubernetes (`:ctx`);
- переключение пространства имён (`:ns`).

Это снижает риск выполнения операций в неверном окружении и упрощает администрирование нескольких кластеров.
## 6. Мониторинг состояния ресурсов без дополнительных систем визуализации
В учебных или тестовых средах может отсутствовать развернутая система мониторинга.

K9s позволяет просматривать:
- текущее состояние pod’ов и нод;    
- потребление процессорного времени;
- использование оперативной памяти.

Информация обновляется в реальном времени и подходит для первичной оценки состояния кластера. При этом K9s не заменяет специализированные системы мониторинга, а дополняет их.

---
# Возможные проблемы
## 1. Недостаток оперативной памяти или вычислительных ресурсов
Если на компьютере (или виртуальной машине) менее 2 ядер ЦПУ или недостаточный объём оперативной памяти, Minikube может либо отказаться запускаться, либо стартовать нестабильно с ошибками на этапе инициализации кластера.

#### Минимальные требования Minikube:
- не менее **2 ЦПУ**
- не менее **~1800 Мб оперативной памяти**

## Решение
### Очистка кластера Minikube
```bash
minikube delete -p minikube
podman rm -af
podman volume rm -f minikube
```

### Явное указание ресурсов при запуске Minikube
```bash
minikube start --container-runtime=containerd --cpus=2 --memory=1800
```
При наличии возможности рекомендуется выделять немного больше ресурсов (например, 2000–2200 Мб ОЗУ), чтобы повысить стабильность работы кластера.


## 2. Длительный запуск Minikube или зависание на этапе инициализации кластера
В ряде случаев после выполнения команды запуска Minikube процесс может выполняться продолжительное время без явных признаков завершения либо завершаться сообщениями о превышении времени ожидания (timeout). 

#### Причина
В процессе запуска Minikube последовательно выполняются следующие операции:
- загрузка контейнерных образов;
- инициализация компонентов управляющей плоскости Kubernetes;
- создание и настройка системных pod’ов.

При медленном сетевом соединении, ограниченной производительности системы или первом запуске кластера данный процесс может занимать значительное время.
### Решение
Рекомендуется:
- дождаться завершения инициализации кластера;
- убедиться в доступности узла Kubernetes;
- при необходимости выполнить повторный запуск после очистки окружения.

Проверка состояния кластера:
```bash
kubectl get nodes
kubectl get pods -n kube-system
```

Если запуск кластера регулярно завершается с ошибками, рекомендуется удалить текущий профиль Minikube и выполнить инициализацию заново.

---

## 3. Отсутствие ожидаемых ресурсов в интерфейсе K9s после успешного запуска
После успешного запуска Minikube и запуска K9s пользователь может не обнаружить ожидаемые pod’ы, сервисы или другие ресурсы в интерфейсе.

#### Причина
K9s отображает ресурсы Kubernetes в рамках:
- активного контекста;
- выбранного пространства имён.

По умолчанию используется пространство имён `default`.  
Ресурсы, размещённые в других пространствах имён (включая системные компоненты Kubernetes), в этом случае не отображаются.

### Решение
Рекомендуется:
- проверить активный контекст Kubernetes;
- убедиться в корректности выбранного пространства имён;
- при необходимости отобразить ресурсы из всех пространств имён.

Переключение контекста:
```bash
:ctx
```

Переключение пространства имён:
```bash
:ns
```

Отображение ресурсов из всех пространств имён:
```bash
0
```

После выполнения указанных действий ресурсы станут доступны для просмотра в интерфейсе K9s.
